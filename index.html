<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not√≠cias do Dia - Geradas por IA</title>
    <meta name="description" content="As √∫ltimas not√≠cias e tend√™ncias do Brasil e do mundo, selecionadas e escritas por intelig√™ncia artificial para voc√™.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Anima√ß√£o simples de fade-in para os artigos */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .article-card {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        /* Anima√ß√£o do spinner */
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-black text-center text-blue-600">Not√≠cias do Dia ü§ñ</h1>
            <p class="text-center text-gray-600 mt-1">As principais tend√™ncias, analisadas e escritas por IA.</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Indicador de Carregamento -->
        <div id="loading-indicator" class="flex flex-col items-center justify-center py-20">
            <div class="loader"></div>
            <p id="loading-text" class="mt-4 text-lg text-gray-600 font-semibold">Buscando as not√≠cias mais quentes...</p>
            <p class="text-sm text-gray-500">Isso pode levar um minutinho. O caf√© est√° quase pronto!</p>
        </div>

        <!-- Container para os Artigos -->
        <div id="articles-container" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            <!-- Os artigos gerados pela IA ser√£o inseridos aqui -->
        </div>
    </main>

    <footer class="text-center py-6 mt-8 bg-white shadow-inner">
        <p class="text-gray-500">&copy; 2025 - Site de Not√≠cias Automatizado. Todos os direitos reservados.</p>
    </footer>

    <script type="module">
        // --- CONFIGURA√á√ïES ---
        const ARTICLES_TO_GENERATE = 3;
        
        // ‚ñº‚ñº‚ñº COLE SUA CHAVE DE API AQUI DENTRO DAS ASPAS ‚ñº‚ñº‚ñº
        const apiKey = "curl "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent" \
  -H 'Content-Type: application/json' \
  -H 'X-goog-api-key: GEMINI_API_KEY' \
  -X POST \
  -d '{
    "contents": [
      {
        "parts": [
          {
            "text": "Explain how AI works in a few words"
          }
        ]
      }
    ]
  }'"; 
        // ‚ñ≤‚ñ≤‚ñ≤ COLE SUA CHAVE DE API AQUI DENTRO DAS ASPAS ‚ñ≤‚ñ≤‚ñ≤

        // --- ELEMENTOS DO DOM ---
        const articlesContainer = document.getElementById('articles-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const loadingText = document.getElementById('loading-text');

        // --- FUN√á√ïES DA API GEMINI ---

        /**
         * Realiza uma chamada fetch com l√≥gica de retentativa e exponential backoff.
         * @param {string} url - A URL da API.
         * @param {object} options - As op√ß√µes para a chamada fetch.
         * @param {number} retries - O n√∫mero de tentativas.
         * @returns {Promise<Response>} A resposta da API.
         */
        async function fetchWithRetry(url, options, retries = 3) {
            let delay = 1000; // 1 segundo de espera inicial
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    console.warn(`API falhou com status ${response.status}. Tentando novamente em ${delay / 1000}s...`);
                    const errorBody = await response.text();
                    console.error("Detalhe do erro:", errorBody);
                } catch (error) {
                    console.warn(`Fetch falhou: ${error.message}. Tentando novamente em ${delay / 1000}s...`);
                }
                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2; // Dobra o tempo de espera para a pr√≥xima tentativa
            }
            throw new Error(`API falhou ap√≥s ${retries} tentativas.`);
        }

        /**
         * Gera o conte√∫do de um artigo (t√≠tulo, texto, metadescription) usando a API Gemini.
         * @param {string[]} existingTitles - T√≠tulos de artigos j√° gerados para evitar repeti√ß√£o.
         * @returns {Promise<Object|null>} Um objeto com {title, content, metaDescription} ou null em caso de erro.
         */
        async function generateArticleContent(existingTitles = []) {
            const systemPrompt = `
                Voc√™ √© um jornalista digital brasileiro, especialista em criar conte√∫do viral e de f√°cil leitura.
                Seu tom √© descontra√≠do, informativo e envolvente.
                Sua tarefa √© criar um artigo completo sobre um t√≥pico em alta no Brasil hoje.
                O artigo deve ter um t√≠tulo extremamente chamativo (formato de not√≠cia), uma meta description otimizada para SEO com no m√°ximo 160 caracteres, e o conte√∫do do artigo com cerca de 3 a 4 par√°grafos.
                O conte√∫do deve explicar o t√≥pico de forma clara e interessante para o p√∫blico geral.
            `;
            const userQuery = `Com base nas buscas atuais do Google, escolha um dos t√≥picos mais quentes no Brasil e escreva um artigo sobre ele. Evite os seguintes t√≥picos que j√° foram abordados: ${existingTitles.join(', ')}.`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            title: { type: "STRING" },
                            content: { type: "STRING" },
                            metaDescription: { type: "STRING" }
                        },
                        required: ["title", "content", "metaDescription"]
                    }
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                return text ? JSON.parse(text) : null;
            } catch (error) {
                console.error("Falha ao gerar conte√∫do do artigo ap√≥s m√∫ltiplas tentativas:", error);
                return null;
            }
        }
        
        /**
         * Gera uma imagem relacionada a um t√≠tulo usando a API Imagen.
         * @param {string} prompt - O t√≠tulo do artigo para basear a imagem.
         * @returns {Promise<string|null>} A URL da imagem em base64 ou uma imagem padr√£o em caso de erro.
         */
        async function generateArticleImage(prompt) {
             const defaultImage = `https://placehold.co/600x400/3498db/ffffff?text=Imagem+Indispon√≠vel`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            const payload = { 
                instances: [{ prompt: `Uma imagem fotorrealista, estilo de not√≠cia, para um artigo sobre: "${prompt}"` }],
                parameters: { "sampleCount": 1 }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                if (result.predictions && result.predictions[0]?.bytesBase64Encoded) {
                    return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                }
                return defaultImage;
            } catch (error) {
                console.error("Falha ao gerar imagem do artigo ap√≥s m√∫ltiplas tentativas:", error);
                return defaultImage;
            }
        }


        // --- L√ìGICA DE EXIBI√á√ÉO ---

        /**
         * Renderiza os artigos na p√°gina.
         * @param {Array<Object>} articles - Um array de objetos de artigo.
         */
        function displayArticles(articles) {
            loadingIndicator.style.display = 'none';
            articlesContainer.innerHTML = ''; // Limpa o container

            articles.forEach(article => {
                if (!article || !article.title || !article.content) return;

                const articleEl = document.createElement('article');
                articleEl.className = 'article-card bg-white rounded-lg shadow-lg overflow-hidden flex flex-col';
                articleEl.innerHTML = `
                    <img src="${article.imageUrl}" alt="${article.title}" class="w-full h-48 object-cover">
                    <div class="p-6 flex flex-col flex-grow">
                        <h2 class="text-2xl font-bold mb-2">${article.title}</h2>
                        <div class="text-gray-700 leading-relaxed flex-grow">
                            ${article.content.split('\n').map(p => `<p class="mb-4">${p}</p>`).join('')}
                        </div>
                         <meta name="description" content="${article.metaDescription}">
                    </div>
                `;
                articlesContainer.appendChild(articleEl);
            });
        }

        // --- FUN√á√ÉO PRINCIPAL ---

        /**
         * Ponto de entrada. Verifica o armazenamento local e decide se gera novos artigos.
         */
        async function main() {
            if (!apiKey) {
                loadingIndicator.innerHTML = '<p class="text-red-500 font-bold text-center">CONFIGURA√á√ÉO NECESS√ÅRIA:<br>Por favor, adicione sua Chave de API da Google AI no arquivo index.html.<br>Cole a chave entre as aspas na vari√°vel "apiKey".</p>';
                return;
            }

            const today = new Date().toISOString().split('T')[0]; // Formato AAAA-MM-DD
            const storedArticlesData = JSON.parse(localStorage.getItem('dailyNews'));

            if (storedArticlesData && storedArticlesData.date === today) {
                console.log("Carregando not√≠cias salvas de hoje.");
                displayArticles(storedArticlesData.articles);
            } else {
                console.log("Nenhuma not√≠cia salva para hoje. Gerando novas...");
                loadingIndicator.style.display = 'flex';
                
                try {
                    const articlesContent = [];
                    // Gera o conte√∫do dos artigos sequencialmente para evitar sobrecarga na API
                    for (let i = 0; i < ARTICLES_TO_GENERATE; i++) {
                        loadingText.textContent = `Gerando artigo ${i + 1} de ${ARTICLES_TO_GENERATE}...`;
                        const existingTitles = articlesContent.map(a => a.title);
                        const content = await generateArticleContent(existingTitles);
                        if (content) {
                            articlesContent.push(content);
                        } else {
                            // Se um artigo falhar, pare de tentar para n√£o gastar recursos
                            console.error(`Falha ao gerar conte√∫do para o artigo ${i + 1}. Parando.`);
                            break; 
                        }
                    }
                    
                    if (articlesContent.length === 0) {
                         loadingIndicator.innerHTML = '<p class="text-red-500 font-bold">Oops! N√£o foi poss√≠vel gerar as not√≠cias hoje. Tente novamente mais tarde.</p>';
                         return;
                    }

                    loadingText.textContent = 'Criando imagens para os artigos...';

                    // Gera as imagens para os artigos que tiveram conte√∫do gerado
                    const finalArticles = await Promise.all(
                        articlesContent.map(async (content) => {
                            const imageUrl = await generateArticleImage(content.title);
                            return { ...content, imageUrl };
                        })
                    );

                    // Salva no localStorage
                    const dataToStore = {
                        date: today,
                        articles: finalArticles
                    };
                    localStorage.setItem('dailyNews', JSON.stringify(dataToStore));

                    // Exibe na tela
                    displayArticles(finalArticles);

                } catch (error) {
                    console.error("Erro geral no processo de cria√ß√£o de not√≠cias:", error);
                    loadingIndicator.innerHTML = '<p class="text-red-500 font-bold">Ocorreu um erro inesperado. Por favor, atualize a p√°gina.</p>';
                }
            }
        }

        // Inicia a aplica√ß√£o
        main();
    </script>

</body>
</html>

